<!DOCTYPE html>
<html>
<head>
<title>Face Lock (Simulated)</title>
<style>
body {
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  margin: 0;
  background-color: #f0f0f0;
}

#camera-container {
  position: relative;
  width: 320px; /* Adjust for desired camera view size */
  height: 240px; /* Adjust for desired camera view size */
  border: 1px solid #ccc;
  margin-bottom: 20px;
  overflow: hidden; /* Hide overflow for a clean border */
}

#camera-view {
  width: 100%;
  height: 100%;
}

#overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; /* Allows clicks to pass through to the camera */
}

#message {
  font-size: 1.2em;
  margin-bottom: 10px;
  color: #333;
}

#unlock-button {
  padding: 10px 20px;
  font-size: 1em;
  background-color: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
  border-radius: 5px;
}

#unlock-button:hover {
  background-color: #3e8e41;
}

#locked-screen {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  color: white;
  text-align: center;
  padding-top: 50vh;
  font-size: 2em;
}
</style>
</head>
<body>

<div id="camera-container">
  <video id="camera-view" autoplay playsinline></video>
  <canvas id="overlay"></canvas>
</div>

<div id="message">Scanning for face...</div>
<button id="unlock-button">Unlock (Simulated)</button>

<div id="locked-screen">
  LOCKED! Face not recognized.
</div>

<script>
const cameraView = document.getElementById('camera-view');
const overlayCanvas = document.getElementById('overlay');
const overlayContext = overlayCanvas.getContext('2d');
const messageElement = document.getElementById('message');
const unlockButton = document.getElementById('unlock-button');
const lockedScreen = document.getElementById('locked-screen');

let stream = null;
let isLocked = true;  // Start locked

// Simulate face data (replace with actual face detection logic)
const simulatedFaceData = {
    x: 100,
    y: 80,
    width: 120,
    height: 150,
};


function startCamera() {
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(s) {
                stream = s;
                cameraView.srcObject = stream;

                cameraView.addEventListener('loadedmetadata', () => {
                    overlayCanvas.width = cameraView.videoWidth;
                    overlayCanvas.height = cameraView.videoHeight;
                    drawOverlay(); // Start drawing the overlay immediately
                });


            })
            .catch(function(error) {
                console.error('Error accessing camera:', error);
                messageElement.textContent = "Error accessing camera.  Check permissions.";
            });
    } else {
        messageElement.textContent = "Camera not supported in this browser.";
    }
}

function drawOverlay() {
    if (!stream) return; // Make sure camera is ready

    overlayContext.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);

    // Simulate drawing a rectangle around a detected face
    if (simulatedFaceData) {
        overlayContext.strokeStyle = 'red';
        overlayContext.lineWidth = 3;
        overlayContext.strokeRect(simulatedFaceData.x, simulatedFaceData.y, simulatedFaceData.width, simulatedFaceData.height);
    }

    requestAnimationFrame(drawOverlay); // Keep drawing the overlay
}


function unlockFace() {
  // This is a SIMULATION.  In a real application, you'd:
  // 1. Analyze the face data from the camera.
  // 2. Compare it to a known face.
  // 3. If it matches closely enough, unlock.

  // For now, just simulate a successful unlock.
  isLocked = false;
  messageElement.textContent = "Face recognized!";
  lockedScreen.style.display = 'none';
  setTimeout(() => {
     messageElement.textContent = "Scanning for face..."; // Revert after a delay
     isLocked = true; //Simulate relocking after a short time
     lockedScreen.style.display = 'block';

  }, 3000); // Simulate relocking after 3 seconds.


}

function lockFace() {
    isLocked = true;
    messageElement.textContent = "Face not recognized!";
    lockedScreen.style.display = 'block';
}


unlockButton.addEventListener('click', () => {
  unlockFace();
});


// Initially lock the screen
lockFace();

//Start the camera
startCamera();


</script>

</body>
</html>
