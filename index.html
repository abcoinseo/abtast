<!DOCTYPE html>
<html>
<head>
<title>Motion Detector Camera</title>
<style>
  body {
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    background-color: #f0f0f0;
  }

  #video-container {
    position: relative;
  }

  #video-element {
    width: 640px;
    height: 480px;
    background-color: black; /* Placeholder until video loads */
  }

  #debug-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 640px;
    height: 480px;
    pointer-events: none; /* Ensure canvas doesn't block interaction */
  }

  #status {
    margin-top: 10px;
    font-weight: bold;
    color: #333;
  }

  .motion-detected {
    color: red;
  }
</style>
</head>
<body>

  <h1>Motion Detector Camera</h1>

  <div id="video-container">
    <video id="video-element" autoplay muted></video>
    <canvas id="debug-canvas"></canvas>
  </div>

  <div id="status">No motion detected.</div>


  <script>
    const videoElement = document.getElementById('video-element');
    const debugCanvas = document.getElementById('debug-canvas');
    const statusElement = document.getElementById('status');
    const debugContext = debugCanvas.getContext('2d');

    let previousFrameData = null;
    const motionThreshold = 25; // Adjust sensitivity (lower = more sensitive)
    const detectionInterval = 100; // milliseconds between frames

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 }, audio: false });
        videoElement.srcObject = stream;
      } catch (error) {
        console.error("Error accessing camera:", error);
        statusElement.textContent = "Error accessing camera. Check permissions.";
      }
    }

    function detectMotion() {
      if (!videoElement.videoWidth) {
        return; // Wait for video to load
      }


      debugCanvas.width = videoElement.videoWidth;
      debugCanvas.height = videoElement.videoHeight;
      debugContext.drawImage(videoElement, 0, 0, debugCanvas.width, debugCanvas.height);
      const currentFrameData = debugContext.getImageData(0, 0, debugCanvas.width, debugCanvas.height).data;

      if (previousFrameData) {
        let motionDetected = false;
        let diffCount = 0;
        for (let i = 0; i < currentFrameData.length; i += 4) {
          const rDiff = Math.abs(currentFrameData[i] - previousFrameData[i]);
          const gDiff = Math.abs(currentFrameData[i + 1] - previousFrameData[i + 1]);
          const bDiff = Math.abs(currentFrameData[i + 2] - previousFrameData[i + 2]);

          if (rDiff > motionThreshold || gDiff > motionThreshold || bDiff > motionThreshold) {
            diffCount++;
          }
        }

         // Simple threshold for motion based on the number of different pixels
         if (diffCount > 2000) {
            motionDetected = true;
         }

        if (motionDetected) {
          statusElement.textContent = "Motion detected!";
          statusElement.classList.add('motion-detected'); // Highlight with CSS
          // You can add more actions here (e.g., sound alert, data logging)
        } else {
          statusElement.textContent = "No motion detected.";
          statusElement.classList.remove('motion-detected');
        }
      }


      previousFrameData = new Uint8ClampedArray(currentFrameData); // Clone the data
      setTimeout(detectMotion, detectionInterval);
    }


    videoElement.addEventListener('loadedmetadata', () => {
      debugCanvas.width = videoElement.videoWidth;
      debugCanvas.height = videoElement.videoHeight;
      setTimeout(detectMotion, detectionInterval);
    });


    startCamera(); // Start the camera feed on page load
  </script>

</body>
</html>
