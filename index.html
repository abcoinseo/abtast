<!DOCTYPE html>
<html>
<head>
<title>Webcam Fun</title>
<style>
body {
  font-family: sans-serif;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background-color: #222;
  color: #eee;
}

#container {
  position: relative;
}

#video {
  width: 640px; /* Adjust as needed */
  height: 480px; /* Adjust as needed */
  background-color: black;
  object-fit: cover; /* Prevents distortion */
}

#overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; /* Allows clicks through to video */
}

#controls {
  margin-top: 10px;
  display: flex;
  gap: 10px;
}

button {
  padding: 8px 12px;
  background-color: #444;
  color: #fff;
  border: none;
  cursor: pointer;
  border-radius: 4px;
}

button:hover {
  background-color: #555;
}

#flashlight-button {
  background-color: #333;
}
#flashlight-button.active {
  background-color: yellow;
  color: black;
}
</style>
</head>
<body>

<h1>Webcam Fun</h1>

<div id="container">
  <video id="video" autoplay muted playsinline></video>
  <canvas id="overlay" width="640" height="480"></canvas>
</div>

<div id="controls">
  <button id="capture-button">Capture</button>
  <button id="flashlight-button">Flashlight</button>
  <button id="timer-button">3-Second Timer</button>
</div>

<script>
const video = document.getElementById('video');
const overlayCanvas = document.getElementById('overlay');
const overlayContext = overlayCanvas.getContext('2d');
const captureButton = document.getElementById('capture-button');
const flashlightButton = document.getElementById('flashlight-button');
const timerButton = document.getElementById('timer-button');

let stream = null;
let flashlightOn = false;

// Get User Media (Webcam Access)
async function startWebcam() {
  try {
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });
    video.srcObject = stream;
  } catch (err) {
    console.error("Error accessing webcam:", err);
    alert("Error accessing webcam. Make sure you have a camera and have granted permission.");
  }
}

// Stop Webcam
function stopWebcam() {
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
        video.srcObject = null;
    }
}

// Capture Image
captureButton.addEventListener('click', () => {
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

  // Convert to data URL and create a download link
  const dataURL = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = dataURL;
  a.download = 'webcam_capture.png';
  a.style.display = 'none';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
});


// Flashlight (Basic) - This is very limited on mobile browsers
flashlightButton.addEventListener('click', () => {
  flashlightOn = !flashlightOn;
  flashlightButton.classList.toggle('active', flashlightOn);

  if (stream) {
    const track = stream.getVideoTracks()[0];
    const capabilities = track.getCapabilities(); //Check what the camera supports.
    if ('torch' in capabilities) {  //Check if the camera supports flashlight feature.
      track.applyConstraints({ advanced: [{ torch: flashlightOn }] })
        .catch(error => console.error('Torch Error: ', error)); //Error handling is important
    } else {
      alert("Flashlight not supported by your camera."); //Inform user.
    }
  } else {
    alert("Start the webcam first!");
  }
});

// 3-Second Timer
timerButton.addEventListener('click', () => {
  let countdown = 3;
  timerButton.disabled = true; //Disable the button during countdown.
  const interval = setInterval(() => {
    alert(countdown);
    countdown--;
    if (countdown < 0) {
      clearInterval(interval);
      captureButton.click(); // Simulate a click on the capture button
      timerButton.disabled = false; //Enable the button again
    }
  }, 1000);
});

// **Hand Detection (VERY Simplified)**
// This will be very basic and inaccurate without a proper hand tracking library
function detectHandMotion() {
    overlayContext.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);

    // Capture a frame from the video
    overlayContext.drawImage(video, 0, 0, overlayCanvas.width, overlayCanvas.height);

    // Get image data (grayscale conversion for simplicity)
    const imageData = overlayContext.getImageData(0, 0, overlayCanvas.width, overlayCanvas.height);
    const data = imageData.data;
    let totalBrightness = 0;

    for (let i = 0; i < data.length; i += 4) {
        // Simple grayscale conversion
        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;
        totalBrightness += brightness;
    }

    const averageBrightness = totalBrightness / (overlayCanvas.width * overlayCanvas.height);

    // Basic motion detection (comparing with a previous frame would be better)
    // Adjust this threshold as needed
    if (averageBrightness > 100) {
        console.log("Potential Hand Motion Detected!");
        // You could trigger some action here (e.g., speed up, no entry)
    }
}


// Start the webcam on page load and setup the hand detection interval
window.addEventListener('load', () => {
    startWebcam();
    setInterval(detectHandMotion, 100); // Adjust interval (milliseconds) as needed
});

// Stop the webcam on page unload, to release camera resources.
window.addEventListener('beforeunload', stopWebcam);

</script>

</body>
</html>
