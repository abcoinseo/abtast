<!DOCTYPE html>
<html>
<head>
<title>Full-Screen Face Lock (Simulated)</title>
<style>
body {
  font-family: sans-serif;
  margin: 0;
  overflow: hidden; /* Prevent scrollbars */
  background-color: #000; /* Dark background for pro look */
  color: #fff;
}

#camera-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

#camera-view {
  width: 100%;  /* Full width */
  height: auto; /* Maintain aspect ratio */
  transform: scaleX(-1); /* Flip horizontally for "mirror" effect */
  object-fit: cover; /* Cover the entire container */
}

#overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

#message {
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 1.5em;
  color: #eee;
}

#locked-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  color: #fff;
  text-align: center;
  padding-top: 50vh;
  font-size: 2em;
  display: none; /* Initially hidden */
  z-index: 1000; /* Ensure it's on top */
}

.face-dot {
  position: absolute;
  width: 8px;
  height: 8px;
  background-color: #00ff00; /* Green dots */
  border-radius: 50%;
  pointer-events: none;
  z-index: 1;
}

#instructions {
  position: absolute;
  bottom: 20px;
  left: 20px;
  font-size: 1em;
  color: #ccc;
}
</style>
</head>
<body>

<div id="camera-container">
  <video id="camera-view" autoplay playsinline></video>
  <canvas id="overlay"></canvas>
</div>

<div id="message">Scanning for face...</div>

<div id="locked-screen">
  LOCKED! Face not recognized.
</div>

<div id="instructions">Simulated: Face detection and storage are not real.</div>

<script>
const cameraView = document.getElementById('camera-view');
const overlayCanvas = document.getElementById('overlay');
const overlayContext = overlayCanvas.getContext('2d');
const messageElement = document.getElementById('message');
const lockedScreen = document.getElementById('locked-screen');
const cameraContainer = document.getElementById('camera-container');

let stream = null;
let isLocked = true;
let faceData = null; // Store "saved" face data
let faceDots = []; // Array to hold face dots elements

function startCamera() {
  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } }) // Force front camera
      .then(function(s) {
        stream = s;
        cameraView.srcObject = stream;

        cameraView.addEventListener('loadedmetadata', () => {
          overlayCanvas.width = cameraView.videoWidth;
          overlayCanvas.height = cameraView.videoHeight;
          drawOverlay();
        });
      })
      .catch(function(error) {
        console.error('Error accessing camera:', error);
        messageElement.textContent = "Error accessing camera. Check permissions.";
      });
  } else {
    messageElement.textContent = "Camera not supported in this browser.";
  }
}

function drawOverlay() {
  if (!stream) return;

  overlayContext.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);

  // Simulated face detection (replace with real face detection library)
  let simulatedFace = null;
  if (isLocked) {
    simulatedFace = getSimulatedFaceData(); // Get random face location
  } else {
    simulatedFace = faceData; // Use the "saved" face data
  }

  if (simulatedFace) {
      drawFaceDots(simulatedFace);  // Draw dots

      // Check if face is close enough to saved face
      if (!isLocked && areFacesSimilar(simulatedFace, faceData)) {
        messageElement.textContent = "Face recognized!";
        lockedScreen.style.display = 'none';

        setTimeout(() => {
          messageElement.textContent = "Scanning for face...";
          isLocked = true;
          lockedScreen.style.display = 'block';
        }, 3000);
      }
  }
  requestAnimationFrame(drawOverlay);
}


function getSimulatedFaceData() {
    // Generate a random face position (replace with real detection)
    const x = Math.random() * (overlayCanvas.width - 100);
    const y = Math.random() * (overlayCanvas.height - 100);
    const width = 80 + Math.random() * 50;
    const height = 100 + Math.random() * 50;
    return { x: x, y: y, width: width, height: height };
}

function drawFaceDots(face) {
  // Clear existing dots
  faceDots.forEach(dot => dot.remove());
  faceDots = [];

  // Draw dots around the face (more realistic than a simple rectangle)
  const numDots = 20; // Adjust number of dots for density
  for (let i = 0; i < numDots; i++) {
    const angle = (i / numDots) * 2 * Math.PI;
    const radius = Math.min(face.width, face.height) / 2;
    const dotX = face.x + face.width / 2 + radius * Math.cos(angle);
    const dotY = face.y + face.height / 2 + radius * Math.sin(angle);

    const dot = document.createElement('div');
    dot.classList.add('face-dot');
    dot.style.left = dotX + 'px';
    dot.style.top = dotY + 'px';
    cameraContainer.appendChild(dot);
    faceDots.push(dot);
  }
}

function areFacesSimilar(face1, face2) {
  // Basic check for face position similarity (replace with real comparison)
  if (!face1 || !face2) return false;
  const distance = Math.sqrt(Math.pow(face1.x - face2.x, 2) + Math.pow(face1.y - face2.y, 2));
  return distance < 50; // Adjust threshold
}


function saveFaceData() {
    // Get the current simulated face data (replace with real detection)
    faceData = getSimulatedFaceData();
    if (faceData) {
      messageElement.textContent = "Face saved! Scanning...";
      isLocked = true;
      lockedScreen.style.display = 'block';

      // Simulate relocking
      setTimeout(() => {
        messageElement.textContent = "Scanning for face...";
      }, 3000);
    } else {
      messageElement.textContent = "No face detected to save.";
    }
}


// Event listener to save the face when the user clicks/taps the screen
cameraContainer.addEventListener('click', saveFaceData);
cameraContainer.addEventListener('touchstart', saveFaceData); //For touch devices



// Initially lock the screen
lockFace();

function lockFace() {
  isLocked = true;
  messageElement.textContent = "Face not recognized!";
  lockedScreen.style.display = 'block';
}


startCamera();
</script>
</body>
</html>
