<!DOCTYPE html>
<html>
<head>
<title>Simple Walkie-Talkie</title>
<style>
body {
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

#message-input {
  width: 300px;
  padding: 10px;
  margin-bottom: 10px;
}

#send-button {
  padding: 10px 20px;
  background-color: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
}

#status {
  margin-top: 10px;
}

#messages {
  margin-top: 20px;
  width: 300px;
}
.message {
  padding: 8px;
  border-bottom: 1px solid #eee;
}
</style>
</head>
<body>

<h1>Simple Walkie-Talkie</h1>

<input type="text" id="message-input" placeholder="Enter your message">
<button id="send-button">Send</button>

<div id="status"></div>
<div id="messages"></div>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
  apiKey: "AIzaSyBQMke0SOMIq0rod6vOm4jrFJ4cExfJPNE",
  authDomain: "ab-studio-4c309.firebaseapp.com",
  databaseURL: "https://ab-studio-4c309-default-rtdb.firebaseio.com",
  projectId: "ab-studio-4c309",
  storageBucket: "ab-studio-4c309.firebasestorage.app",
  messagingSenderId: "290321392308",
  appId: "1:290321392308:web:eed8f4bda17a51944eade1"
};

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const messagesRef = ref(database, 'messages');

  const messageInput = document.getElementById('message-input');
  const sendButton = document.getElementById('send-button');
  const statusDiv = document.getElementById('status');
  const messagesDiv = document.getElementById('messages');

  // Function to speak text
  function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    window.speechSynthesis.speak(utterance);
  }

  // Send Message
  sendButton.addEventListener('click', () => {
    const messageText = messageInput.value.trim();
    if (messageText !== '') {
      push(messagesRef, { text: messageText, timestamp: Date.now() })
        .then(() => {
          messageInput.value = '';
          statusDiv.textContent = 'Message sent!';
          setTimeout(() => { statusDiv.textContent = ''; }, 2000);
        })
        .catch((error) => {
          console.error("Error sending message: ", error);
          statusDiv.textContent = 'Error sending message.';
        });
    }
  });

  // Listen for new messages
  onValue(messagesRef, (snapshot) => {
    messagesDiv.innerHTML = ''; // Clear existing messages
    const messages = snapshot.val();

    if (messages) {
      Object.entries(messages).forEach(([key, message]) => {
        const messageElement = document.createElement('div');
        messageElement.classList.add('message');
        messageElement.textContent = message.text;
        messagesDiv.appendChild(messageElement);

        speak(message.text); // Speak the message

        // Optional: Delete the message after speaking (for a true walkie-talkie feel)
        remove(ref(database, `messages/${key}`))
          .catch(error => {
            console.error("Error deleting message:", error);
          });
      });
    } else {
      messagesDiv.textContent = 'No messages yet.';
    }
  });


</script>

</body>
</html>
